Rm9yZSA9IGNvbG9yYW1hLkZvcmU7Y29sb3JhbWEuaW5pdChhdXRvcmVzZXQ9VHJ1ZSkKTWVzc2FnZUJveCA9IGN0eXBlcy53aW5kbGwudXNlcjMyLk1lc3NhZ2VCb3hXCnRyeToKCVNldHRpbmdzID0gb3BlbignU2V0dGluZ3MudHh0JywgJ3InLCBlbmNvZGluZz0idXRmLTgiKS5yZWFkKCkKY2xlYXIgPSBsYW1iZGEgOiBzdWJwcm9jZXNzLmNhbGwoJ2Nsc3x8Y2xlYXInLCBzaGVsbD1UcnVlKQpvcy5zeXN0ZW0oJ3B5dGhvbi5leGUgLW0gcGlwIGluc3RhbGwgcHlzb2NrcycpCm9zLnN5c3RlbSgncHl0aG9uLmV4ZSAtbSBwaXAgaW5zdGFsbCAtVSByZXF1ZXN0c1tzb2Nrc10nKQp0cnk6CiAgICBpbXBvcnQgcmVxdWVzdHMKZXhjZXB0IEltcG9ydEVycm9yOgogICAgb3Muc3lzdGVtKCdweXRob24uZXhpZSAtbSBwaXAgaW5zdGFsbCByZXF1ZXN0cycpCiAgICBpbXBvcnQgcmVxdWVzdHMKCnRyeToKICAgIGltcG9ydCBjb2xvcmFtYQpleGNlcHQgSW1wb3J0RXJyb3I6CiAgICBvcy5zeXN0ZW0oJ3B5dGhvbi5leGUgLW0gcGlwIGluc3RhbGwgY29sb3JhbWEnKQogICAgaW1wb3J0IGNvbG9yYW1hCgp0cnk6CiAgICBpbXBvcnQgYXV0b3B5CmV4Y2VwdCBJbXBvcnRFcnJvcjoKICAgIG9zLnN5c3RlbSgncHl0aG9uLmV4ZSAtbSBwaXAgaW5zdGFsbCBhdXRvcHknKQogICAgaW1wb3J0IGF1dG9weQoKY2xlYXIoKQpjb2xvcmFtYS5pbml0KCkKCmNsYXNzIFRIUklESU5HOgoKICAgIGRlZiBfX2luaXRfXyhzZWxmLCB0YXJnZXQpOgogICAgICAgIHNlbGYudGhyZWFkc19saXN0ID0gW10KICAgICAgICBzZWxmLnRhcmdldCA9IHRhcmdldAoKICAgIGRlZiBnZW4oc2VsZiwgdGhyZWFkcyk6CiAgICAgICAgZm9yIGkgaW4gcmFuZ2UodGhyZWFkcyk6CiAgICAgICAgICAgIHQgPSB0aHJlYWRpbmcuVGhyZWFkKHRhcmdldD0oc2VsZi50YXJnZXQpKQogICAgICAgICAgICB0LnNldERhZW1vbihUcnVlKQogICAgICAgICAgICBzZWxmLnRocmVhZHNfbGlzdC5hcHBlbmQodCkKCiAgICAgICAgcmV0dXJuIHNlbGYudGhyZWFkc19saXN0CgogICAgZGVmIHN0YXJ0KHNlbGYpOgogICAgICAgIGZvciB0aHJlYWRfc3RhcnQgaW4gc2VsZi50aHJlYWRzX2xpc3Q6CiAgICAgICAgICAgIHRocmVhZF9zdGFydC5zdGFydCgpCgogICAgZGVmIGpvaW4oc2VsZik6CiAgICAgICAgZm9yIHRocmVhZF9qb2luIGluIHNlbGYudGhyZWFkc19saXN0OgogICAgICAgICAgICB0aHJlYWRfam9pbi5qb2luKCkKCgpjbGFzcyBERVNJR046CiAgICBXSElURSA9ICdceDFiWzE7Mzc7NDBtJwogICAgWUVMTE9XID0gJ1x4MWJbMTszMzs0MG0nCiAgICBSRUQgPSAnXHgxYlsxOzMxOzQwbScKICAgIEJMVUUgPSAnXHgxYlszNm1ceDFiWzQwbScKICAgIEdSRUVOID0gJ1x4MWJbMzJtXHgxYls0MG0nCiAgICBncmVlbnBsdXMgPSBmIntXSElURX1bIHtHUkVFTn0re1dISVRFfSBdIgogICAgYmx1ZXBsdXMgPSBmIntXSElURX1bIHtCTFVFfSt7V0hJVEV9IF0iCiAgICByZWRtaW51cyA9IGYie1dISVRFfVsge1JFRH0te1dISVRFfSBdIgogICAgYmx1ZXByb3hpZXMgPSBmIntXSElURX1bIHtCTFVFfVBST1hJRVMge1dISVRFfV0iCiAgICByZWRwcm94aWVzID0gZiJ7V0hJVEV9WyB7UkVEfVBST1hJRVMge1dISVRFfV0iCiAgICBibHVlYWNjb3VudHMgPSBmIntXSElURX1bIHtCTFVFfUFDQ09VTlRTIHtXSElURX1dIgogICAgcmVkYWNjb3VudHMgPSBmIntXSElURX1bIHtSRUR9QUNDT1VOVFMge1dISVRFfV0iCiAgICBibHVlemVybyA9IGYie1dISVRFfVsge0JMVUV9MCB7V0hJVEV9XSIKICAgIGJsdWVvbmUgPSBmIntXSElURX1bIHtCTFVFfTEge1dISVRFfV0iCiAgICBibHVldHdvID0gZiJ7V0hJVEV9WyB7QkxVRX0yIHtXSElURX1dIgogICAgeHJibHVlID0gZiJcbntibHVlcGx1c30gMTREYXkgQnlwYXNzIHtCTFVFfS8ge1lFTExPV31JbnN0YWdyYW0gPiBAb2wuaiB7WUVMTE9XfTogQnkgQ3Jhenl7V0hJVEV9IgoKCmFjdGl2ZSA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGkuaXBpZnkub3JnLz9mb3JtYXQ9anNvbicpLmpzb24oKQppcCA9IGFjdGl2ZVsnaXAnXQpzY2FuID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL3Bhc3RlYmluLmNvbS9kY1dxa3ZjbScpLnRleHQKaWYgaXAgaW4gc2NhbjoKICAgIHBhc3MKZWxzZToKICAgIHByaW50KGYiaXAge2lwfSBOb3QgQWN0aXZhdGUgQ2FsbCBAb2wuaiBpbiBJbnN0YWdyYW0iKQogICAgaW5wdXQoKQogICAgZXhpdCgwKQoKCnByb3hpZXMgPSBbXQoKY2xhc3MgRklMRVM6CgogICAgZGVmIF9faW5pdF9fKHNlbGYsIGZpbGVuYW1lLCBteV9saXN0KToKICAgICAgICBzZWxmLm9wZW5fZmlsZShmaWxlbmFtZSwgbXlfbGlzdCkKCiAgICBkZWYgb3Blbl9maWxlKHNlbGYsIGZpbGVuYW1lLCBteV9saXN0KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGZvciB4IGluIG9wZW4oZiJ7ZmlsZW5hbWV9LnR4dCIsICdyJykucmVhZCgpLnNwbGl0KCdcbicpOgogICAgICAgICAgICAgICAgaWYgeCAhPSAnJzoKICAgICAgICAgICAgICAgICAgICBteV9saXN0LmFwcGVuZCh4KQoKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZXBsdXN9IFN1Y2Nlc3NmdWxseSBMb2FkIHtERVNJR04uQkxVRX17ZmlsZW5hbWV9LnR4dCIpCiAgICAgICAgICAgIHRpbWUuc2xlZXAoMikKICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7REVTSUdOLlJFRH17ZmlsZW5hbWV9LnR4dCB7REVTSUdOLldISVRFfWlzIG1pc3NpbmcgIiwgZW5kPScnKQogICAgICAgICAgICBpbnB1dCgpCiAgICAgICAgICAgIGV4aXQoKQoKCmNsYXNzIGlobDoKCiAgICBkZWYgX19pbml0X18oc2VsZik6CiAgICAgICAgc2VsZi5kb25lLCBzZWxmLmVycm9yLCBzZWxmLnNldCwgc2VsZi5ydW4sIHNlbGYuYnlwYXNzLCBzZWxmLnNldCwgc2VsZi51c2VybmFtZV9jaGFuZ2VkID0gKDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYWxzZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgRmFsc2UpCiAgICAgICAgc2VsZi5zZXNzaW9ucyA9IFtdCiAgICAgICAgc2VsZi51c2VycyA9IFtdCiAgICAgICAgc2VsZi5ycSA9IHJlcXVlc3RzLnNlc3Npb24oKQogICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVvbmV9IEdyYWIgUHJveGllcyB7REVTSUdOLmJsdWV0d299IExvYWQgUHJveGllczogIiwgZW5kPScnKQogICAgICAgIHByb21vZGUgPSBpbnB1dCgpCiAgICAgICAgaWYgcHJvbW9kZSA9PSAnMSc6CiAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVvbmV9IHByb3h5c2NyYXBlLmNvbSB7REVTSUdOLmJsdWV0d299IE5ldyBQcml2YXRlIEFwaSB7REVTSUdOLlJFRH1UZXN0e0RFU0lHTi5XSElURX06ICIsIGVuZD0nJykKICAgICAgICAgICAgcHJvc2l0ZW1vZGUgPSBpbnB1dCgpCiAgICAgICAgICAgIGlmIHByb3NpdGVtb2RlID09ICcxJzoKICAgICAgICAgICAgICAgIHNlbGYuZ3JhYl9wcm94aWVzMSgpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBpZiBwcm9zaXRlbW9kZSA9PSAnMic6CiAgICAgICAgICAgICAgICAgICAgc2VsZi5ncmFiX3Byb3hpZXMyKCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IEJybyBpdCdzIGp1c3QgMCBvciAxIFdURiBpcyAne3Byb3NpdGVtb2RlfSciKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgcHJvbW9kZSA9PSAnMic6CiAgICAgICAgICAgICAgICBGSUxFUygncHJveGllcycsIHByb3hpZXMpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30gQnJvIGl0J3MganVzdCAwIG9yIDEgV1RGIGlzICd7cHJvbW9kZX0nIikKICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCiAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZW9uZX0gTm9ybWFsIExvZ2luIHtERVNJR04uYmx1ZXR3b30gU2Vzc2lvbmlkOiAiLCBlbmQ9JycpCiAgICAgICAgbG9nbW9kZSA9IGlucHV0KCkKICAgICAgICBpZiBsb2dtb2RlID09ICcxJzoKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZXBsdXN9IHVzZXJuYW1lOiAiLCBlbmQ9JycpCiAgICAgICAgICAgIHNlbGYudXNlcm5hbWUgPSBpbnB1dCgpCiAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVwbHVzfSBwYXNzd29yZDogIiwgZW5kPScnKQogICAgICAgICAgICBzZWxmLnBhc3N3b3JkID0gaW5wdXQoKQogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlb25lfSBBcGkgTG9naW4ge0RFU0lHTi5ibHVldHdvfSBXZWIgTG9naW46ICIsIGVuZD0nJykKICAgICAgICAgICAgYXBpbW9kZSA9IGlucHV0KCkKICAgICAgICAgICAgZm9yIHggaW4gcmFuZ2UoMik6CiAgICAgICAgICAgICAgICBpZiBhcGltb2RlID09ICcxJzoKICAgICAgICAgICAgICAgICAgICBzZWxmLmFwaV9sb2dpbigpCiAgICAgICAgICAgICAgICBlbGlmIGFwaW1vZGUgPT0gJzInOgogICAgICAgICAgICAgICAgICAgIHNlbGYud2ViX2xvZ2luKCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IEJybyBpdCdzIGp1c3QgMCBvciAxIFdURiBpcyAne2FwaW1vZGV9JyIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmV4KCkKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgbG9nbW9kZSA9PSAnMic6CiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gWW91IE5lZWQgVHdvIHtERVNJR04uUkVEfURpZmZlcmVudCBBcGkgU2Vzc2lvbnMge0RFU0lHTi5XSElURX1Gb3IgVGhlIHtERVNJR04uUkVEfVNhbWUgQWNjb3VudCIpCiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gc2Vzc2lvbmlkMTogIiwgZW5kPScnKQogICAgICAgICAgICAgICAgc2Vzc2lvbmlkMSA9IGlucHV0KCkKICAgICAgICAgICAgICAgIGlmIHNlc3Npb25pZDEgPT0gJyc6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IFRoaXMgRmllbGQgSXMgUmVxdWlyZWQiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gc2Vzc2lvbmlkMjogIiwgZW5kPScnKQogICAgICAgICAgICAgICAgc2Vzc2lvbmlkMiA9IGlucHV0KCkKICAgICAgICAgICAgICAgIGlmIHNlc3Npb25pZDIgPT0gJyc6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IFRoaXMgRmllbGQgSXMgUmVxdWlyZWQiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCiAgICAgICAgICAgICAgICBpZiBzZXNzaW9uaWQxID09IHNlc3Npb25pZDI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IFlvdSBOZWVkIFR3byB7REVTSUdOLlJFRH1EaWZmZXJlbnQgQXBpIFNlc3Npb25zIHtERVNJR04uV0hJVEV9Rm9yIFRoZSB7REVTSUdOLlJFRH1TYW1lIEFjY291bnQiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCiAgICAgICAgICAgICAgICBzZWxmLnNlc3Npb25zID0gWwogICAgICAgICAgICAgICAgIHNlc3Npb25pZDEsIHNlc3Npb25pZDJdCiAgICAgICAgICAgICAgICBzZWxmLmNoZWNrX3Nlc3Npb25zKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSBCcm8gaXQncyBqdXN0IDAgb3IgMSBXVEYgaXMgJ3tsb2dtb2RlfSciKQogICAgICAgICAgICAgICAgc2VsZi5pbmV4KCkKICAgICAgICBzZWxmLmN1cnJlbnRfdXNlcigpCiAgICAgICAgc2VsZi5uZXdfdXNlcm5hbWUgPSAnaWhsJyArICcnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xMCkpCgogICAgZGVmIGluZXgoc2VsZik6CiAgICAgICAgc2VsZi5ydW4gPSBGYWxzZQogICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSBFbnRlciBUbyBFeGl0OiAiLCBlbmQ9JycpCiAgICAgICAgaW5wdXQoKQogICAgICAgIG9zLmtpbGwob3MuZ2V0cGlkKCksIHNpZ25hbC5TSUdURVJNKQoKICAgIGRlZiBncmFiX3Byb3hpZXMxKHNlbGYpOgogICAgICAgIHJlcSA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly9hcGkucHJveHlzY3JhcGUuY29tL3YyLz9yZXF1ZXN0PWdldHByb3hpZXMmcHJvdG9jb2w9c29ja3M0JnRpbWVvdXQ9MTAwMDAmY291bnRyeT1hbGwmc3NsPWFsbCZhbm9ueW1pdHk9YWxsJykKICAgICAgICBpZiByZXEuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICBvcGVuKCdwcm94aWVzLnR4dCcsICd3Jykud3JpdGUoZiIiKQogICAgICAgICAgICBmb3IgeCBpbiByZXEudGV4dC5zcGxpdCgnXG4nKToKICAgICAgICAgICAgICAgIG9wZW4oJ3Byb3hpZXMudHh0JywgJ2EnKS53cml0ZShmIlxue3h9IikKCiAgICAgICAgICAgIGZpbGUgPSBvcGVuKCdwcm94aWVzLnR4dCcsICdyJykucmVhZCgpLnNwbGl0KCdcbicpCiAgICAgICAgICAgIGZvciB4IGluIGZpbGU6CiAgICAgICAgICAgICAgICBpZiB4ICE9ICcnIGFuZCB4ICE9ICdcbic6CiAgICAgICAgICAgICAgICAgICAgcHJveGllcy5hcHBlbmQoeCkKCiAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVwbHVzfSB7REVTSUdOLkJMVUV9e2xlbihwcm94aWVzKX0ge0RFU0lHTi5XSElURX1Qcm94aWVzIEdyYWJiZWQgU3VjY2Vzc2Z1bGx5IikKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30ge3JlcS50ZXh0fSwge3JlcS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30gRXJyb3IgV2hpbGUgR3JhYiBQcm94aWVzIikKICAgICAgICAgICAgc2VsZi5pbmV4KCkKCiAgICBkZWYgZ3JhYl9wcm94aWVzMihzZWxmKToKICAgICAgICByZXEgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vYXBpLm9wZW5wcm94eS5zcGFjZS9wcmVtaXVtL3BsYWluP2FwaUtleT1HNU40MS1lbUpwUWV5cXE3NENkZjctSjZ6Y3otNDR5SzdjMzkxMThmTHY5LUdJYlVpJnByb3RvY29scz0yJnN0YWJsZT0wLDEmc3RhdHVzPTEnKQogICAgICAgIGlmIHJlcS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIG9wZW4oJ3Byb3hpZXMudHh0JywgJ3cnKS53cml0ZShmIiIpCiAgICAgICAgICAgIGZvciB4IGluIHJlcS50ZXh0LnNwbGl0KCdcbicpOgogICAgICAgICAgICAgICAgb3BlbigncHJveGllcy50eHQnLCAnYScpLndyaXRlKGYiXG57eH0iKQoKICAgICAgICAgICAgZmlsZSA9IG9wZW4oJ3Byb3hpZXMudHh0JywgJ3InKS5yZWFkKCkuc3BsaXQoJ1xyXG4nKQogICAgICAgICAgICBmb3IgeCBpbiBmaWxlOgogICAgICAgICAgICAgICAgaWYgeCAhPSAnJyBhbmQgeCAhPSAnXG4nOgogICAgICAgICAgICAgICAgICAgIHByb3hpZXMuYXBwZW5kKHgpCgogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30ge0RFU0lHTi5CTFVFfXtsZW4ocHJveGllcyl9IHtERVNJR04uV0hJVEV9UHJveGllcyBHcmFiYmVkIFN1Y2Nlc3NmdWxseSIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IEVycm9yIFdoaWxlIEdyYWIgUHJveGllcyIpCiAgICAgICAgICAgIHNlbGYuaW5leCgpCgogICAgZGVmIGFwaV9zZW5kX2Nob2ljZShzZWxmKToKICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gQ2hvaWNlOiAiLCBlbmQ9JycpCiAgICAgICAgY2hvaWNlID0gc3RyKGlucHV0KCkpCiAgICAgICAgaWYgbm90IGFueSgoeCA9PSBjaG9pY2UgZm9yIHggaW4gKCcwJywgJzEnKSkpOgogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30gQnJvIGl0J3MganVzdCAwIG9yIDEgV1RGIGlzICd7Y2hvaWNlfSciKQogICAgICAgICAgICBzZWxmLmluZXgoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGhlYWQgPSB7J3VzZXItYWdlbnQnOiBmIkluc3RhZ3JhbSAxNTAuMC4wLjAuMDAwIEFuZHJvaWQgKDI5LzEwOyAzMDBkcGk7IDcyMHgxNDQwOyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9L3snJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX07IHsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX07IHsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX07IHsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX07IGVuX0dCOykifQogICAgICAgICAgICBkYXRhID0geydjaG9pY2UnOmNob2ljZSwgCiAgICAgICAgICAgICAnX3V1aWQnOnV1aWQudXVpZDQoKSwgCiAgICAgICAgICAgICAnX3V1ZCc6dXVpZC51dWlkNCgpLCAKICAgICAgICAgICAgICdfY3NyZnRva2VuJzonbWFzc2luZyd9CiAgICAgICAgICAgIHJlcSA9IHJlcXVlc3RzLnBvc3QoZiJodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjF7c2VsZi5wYXRofSIsIGhlYWRlcnM9aGVhZCwgZGF0YT1kYXRhLCBjb29raWVzPShzZWxmLmNvbykpCiAgICAgICAgICAgIGlmIHJlcS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gQ29kZSBTZW50IFRvIHtERVNJR04uQkxVRX17cmVxLmpzb24oKVsnc3RlcF9kYXRhJ11bJ2NvbnRhY3RfcG9pbnQnXX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCgogICAgZGVmIGFwaV9zZW5kX2NvZGUoc2VsZik6CiAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZXBsdXN9IENvZGU6ICIsIGVuZD0nJykKICAgICAgICBjb2RlID0gc3RyKGlucHV0KCkpCiAgICAgICAgaGVhZCA9IHsndXNlci1hZ2VudCc6IGYiSW5zdGFncmFtIDE1MC4wLjAuMC4wMDAgQW5kcm9pZCAoMjkvMTA7IDMwMGRwaTsgNzIweDE0NDA7IHsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX0veycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgZW5fR0I7KSJ9CiAgICAgICAgZGF0YSA9IHsnc2VjdXJpdHlfY29kZSc6Y29kZSwgCiAgICAgICAgICdfdXVpZCc6dXVpZC51dWlkNCgpLCAKICAgICAgICAgJ191dWQnOnV1aWQudXVpZDQoKSwgCiAgICAgICAgICdfY3NyZnRva2VuJzonbWFzc2luZyd9CiAgICAgICAgcmVxID0gcmVxdWVzdHMucG9zdChmImh0dHBzOi8vaS5pbnN0YWdyYW0uY29tL2FwaS92MXtzZWxmLnBhdGh9IiwgaGVhZGVycz1oZWFkLCBkYXRhPWRhdGEsIGNvb2tpZXM9KHNlbGYuY29vKSkKICAgICAgICBpZiAnbG9nZ2VkX2luX3VzZXInIGluIHJlcS50ZXh0OgogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gTG9nZ2VkIEluIHtERVNJR04uQkxVRX0ne3NlbGYudXNlcm5hbWV9JyIpCiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbnMuYXBwZW5kKHJlcS5jb29raWVzLmdldCgnc2Vzc2lvbmlkJykpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgc2VsZi5pbmV4KCkKCiAgICBkZWYgYXBpX2NoYWxsZW5nZShzZWxmKToKICAgICAgICBoZWFkID0geyd1c2VyLWFnZW50JzogZiJJbnN0YWdyYW0gMTUwLjAuMC4wLjAwMCBBbmRyb2lkICgyOS8xMDsgMzAwZHBpOyA3MjB4MTQ0MDsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfS97Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyBlbl9HQjspIn0KICAgICAgICByZXEgPSByZXF1ZXN0cy5nZXQoZiJodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjF7c2VsZi5wYXRofSIsIGhlYWRlcnM9aGVhZCwgY29va2llcz0oc2VsZi5jb28pKQogICAgICAgIGlmICdwaG9uZV9udW1iZXInIGluIHJlcS5qc29uKClbJ3N0ZXBfZGF0YSddOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlemVyb30gcGhvbmVfbnVtYmVyIHtERVNJR04uQkxVRX17cmVxLmpzb24oKVsnc3RlcF9kYXRhJ11bJ3Bob25lX251bWJlciddfSIpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7cmVxLnRleHR9LCB7cmVxLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30gRXJyb3Ige0RFU0lHTi5SRUR9cGhvbmVfbnVtYmVyIikKICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCgogICAgICAgIGlmICdlbWFpbCcgaW4gcmVxLmpzb24oKVsnc3RlcF9kYXRhJ106CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVvbmV9IGVtYWlsIHtERVNJR04uQkxVRX17cmVxLmpzb24oKVsnc3RlcF9kYXRhJ11bJ2VtYWlsJ119IikKICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSBFcnJvciB7REVTSUdOLlJFRH1lbWFpbCIpCiAgICAgICAgICAgICAgICBzZWxmLmluZXgoKQoKICAgICAgICBpZiBub3QgYW55KCh4IGluIHJlcS5qc29uKClbJ3N0ZXBfZGF0YSddIGZvciB4IGluICgncGhvbmVfbnVtYmVyJywgJ2VtYWlsJykpKToKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IFVua25vd24gVmVyaWZpY2F0aW9uIE1ldGhvZCIpCiAgICAgICAgICAgIHNlbGYuaW5leCgpCiAgICAgICAgc2VsZi5hcGlfc2VuZF9jaG9pY2UoKQogICAgICAgIHNlbGYuYXBpX3NlbmRfY29kZSgpCgogICAgZGVmIGFwaV9sb2dpbihzZWxmKToKICAgICAgICBoZWFkID0geyd1c2VyLWFnZW50JzogZiJJbnN0YWdyYW0gMTUwLjAuMC4wLjAwMCBBbmRyb2lkICgyOS8xMDsgMzAwZHBpOyA3MjB4MTQ0MDsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfS97Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyBlbl9HQjspIn0KICAgICAgICBkYXRhID0geydqYXpvZXN0JzonMjI0NTInLCAKICAgICAgICAgJ3Bob25lX2lkJzp1dWlkLnV1aWQ0KCksIAogICAgICAgICAnZW5jX3Bhc3N3b3JkJzpmIiNQV0RfSU5TVEFHUkFNOjA6MDp7c2VsZi5wYXNzd29yZH0iLCAKICAgICAgICAgJ3VzZXJuYW1lJzpzZWxmLnVzZXJuYW1lLCAKICAgICAgICAgJ2d1aWQnOnV1aWQudXVpZDQoKSwgCiAgICAgICAgICdkZXZpY2VfaWQnOnV1aWQudXVpZDQoKSwgCiAgICAgICAgICdnb29nbGVfdG9rZW5zJzonW10nLCAKICAgICAgICAgJ2xvZ2luX2F0dGVtcHRfY291bnQnOicwJ30KICAgICAgICByZXEgPSByZXF1ZXN0cy5wb3N0KCdodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjEvYWNjb3VudHMvbG9naW4vJywgaGVhZGVycz1oZWFkLCBkYXRhPWRhdGEpCiAgICAgICAgaWYgJ2xvZ2dlZF9pbl91c2VyJyBpbiByZXEudGV4dDoKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZXBsdXN9IExvZ2dlZCBJbiB7REVTSUdOLkJMVUV9J3tzZWxmLnVzZXJuYW1lfSciKQogICAgICAgICAgICBzZWxmLnNlc3Npb25zLmFwcGVuZChyZXEuY29va2llcy5nZXQoJ3Nlc3Npb25pZCcpKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGlmICdjaGFsbGVuZ2VfcmVxdWlyZWQnIGluIHJlcS50ZXh0OgogICAgICAgICAgICAgICAgc2VsZi5jb28gPSByZXEuY29va2llcwogICAgICAgICAgICAgICAgc2VsZi5wYXRoID0gcmVxLmpzb24oKVsnY2hhbGxlbmdlJ11bJ2FwaV9wYXRoJ10KICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSBjaGFsbGVuZ2VfcmVxdWlyZWQiKQogICAgICAgICAgICAgICAgc2VsZi5hcGlfY2hhbGxlbmdlKCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7cmVxLmpzb24oKVsnbWVzc2FnZSddfSAxIikKICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCgogICAgZGVmIHdlYl9zZW5kX2Nob2ljZShzZWxmKToKICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gQ2hvaWNlOiAiLCBlbmQ9JycpCiAgICAgICAgY2hvaWNlID0gc3RyKGlucHV0KCkpCiAgICAgICAgaWYgbm90IGFueSgoeCA9PSBjaG9pY2UgZm9yIHggaW4gKCcwJywgJzEnKSkpOgogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30gQnJvIGl0J3MganVzdCAwIG9yIDEgV1RGIGlzICd7Y2hvaWNlfSciKQogICAgICAgICAgICBzZWxmLmluZXgoKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIGRhdGEgPSB7J2Nob2ljZSc6IGNob2ljZX0KICAgICAgICAgICAgcmVxID0gcmVxdWVzdHMucG9zdCgoc2VsZi51cmwpLCBoZWFkZXJzPShzZWxmLndlYl9oZWFkKSwgZGF0YT1kYXRhLCBjb29raWVzPShzZWxmLmNvbykpCiAgICAgICAgICAgIGlmICdFbnRlciBZb3VyIFNlY3VyaXR5JyBpbiByZXEudGV4dDoKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVwbHVzfSBDb2RlIFNlbnQgVG8ge0RFU0lHTi5CTFVFfXtyZXEuanNvbigpWydjb250YWN0X3BvaW50J119IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7cmVxLnRleHR9LCB7cmVxLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICBzZWxmLmluZXgoKQoKICAgIGRlZiB3ZWJfc2VuZF9jb2RlKHNlbGYpOgogICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVwbHVzfSBDb2RlOiAiLCBlbmQ9JycpCiAgICAgICAgY29kZSA9IHN0cihpbnB1dCgpKQogICAgICAgIGRhdGEgPSB7J3NlY3VyaXR5X2NvZGUnOiBjb2RlfQogICAgICAgIHJlcSA9IHJlcXVlc3RzLnBvc3QoKHNlbGYudXJsKSwgaGVhZGVycz0oc2VsZi53ZWJfaGVhZCksIGRhdGE9ZGF0YSwgY29va2llcz0oc2VsZi5jb28pKQogICAgICAgIGlmICd1c2VySWQnIGluIHJlcS50ZXh0OgogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gTG9nZ2VkIEluIHtERVNJR04uQkxVRX0ne3NlbGYudXNlcm5hbWV9JyIpCiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbnMuYXBwZW5kKHJlcS5jb29raWVzLmdldCgnc2Vzc2lvbmlkJykpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgc2VsZi5pbmV4KCkKCiAgICBkZWYgd2ViX2NoYWxsYW5nZShzZWxmKToKICAgICAgICBoZWFkID0geydhY2NlcHQnOid0ZXh0L2h0bWwsYXBwbGljYXRpb24veGh0bWwreG1sLGFwcGxpY2F0aW9uL3htbDtxPTAuOSxpbWFnZS9hdmlmLGltYWdlL3dlYnAsaW1hZ2UvYXBuZywqLyo7cT0wLjgsYXBwbGljYXRpb24vc2lnbmVkLWV4Y2hhbmdlO3Y9YjM7cT0wLjknLCAgJ2FjY2VwdC1lbmNvZGluZyc6J2d6aXAsIGRlZmxhdGUsIGJyJywgCiAgICAgICAgICdhY2NlcHQtbGFuZ3VhZ2UnOidlbi1VUyxlbjtxPTAuOScsIAogICAgICAgICAnY29va2llJzonaWdfZGlkPTA4OTc0OTFGLUI3MzYtNEU3RS1BNjU3LTM3NDM4RDA5NjdCODsgY3NyZnRva2VuPXh2QVFvTWl6MmVhVTRScmNtUnAyaHFpbkRWTWZna3BlOyBydXI9RlRXOyBtaWQ9WHhUUGZnQUxBQUdIR1JlRS14X2kxSVNNRzRYcicsIAogICAgICAgICAnc2VjLWZldGNoLWRlc3QnOidkb2N1bWVudCcsIAogICAgICAgICAnc2VjLWZldGNoLW1vZGUnOiduYXZpZ2F0ZScsIAogICAgICAgICAnc2VjLWZldGNoLXNpdGUnOidub25lJywgCiAgICAgICAgICdzZWMtZmV0Y2gtdXNlcic6Jz8xJywgCiAgICAgICAgICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzJzonMScsIAogICAgICAgICAndXNlci1hZ2VudCc6J01vemlsbGEvNS4yIChMaW51eDsgQW5kcm9pZCA2LjM7IE5leHVzIDUgQnVpbGQvTVJBNThOKSBBcHBsZVdlYktpdC81MzcuMzYgKEtIVE1MLCBsaWtlIEdlY2tvKSBDaHJvbWUvODMuMC40MTAzLjExNiBNb2JpbGUgU2FmYXJpLzUzNy4zNid9CiAgICAgICAgcmVxID0gcmVxdWVzdHMuZ2V0KChzZWxmLnVybCksIGhlYWRlcnM9aGVhZCkKICAgICAgICBpZiAnY2hhbGxlbmdlVHlwZScgaW4gcmVxLnRleHQ6CiAgICAgICAgICAgIGlmICdwaG9uZV9udW1iZXInIGluIHJlcS5qc29uKClbJ2ZpZWxkcyddOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWV6ZXJvfSBwaG9uZV9udW1iZXIge0RFU0lHTi5CTFVFfXtyZXEuanNvbigpWydmaWVsZHMnXVsncGhvbmVfbnVtYmVyJ119IikKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30ge3JlcS50ZXh0fSwge3JlcS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSBFcnJvciB7REVTSUdOLlJFRH1waG9uZV9udW1iZXIiKQogICAgICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCgogICAgICAgICAgICBpZiAnZW1haWwnIGluIHJlcS5qc29uKClbJ2ZpZWxkcyddOgogICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVvbmV9IGVtYWlsIHtERVNJR04uQkxVRX17cmVxLmpzb24oKVsnZmllbGRzJ11bJ2VtYWlsJ119IikKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30ge3JlcS50ZXh0fSwge3JlcS5zdGF0dXNfY29kZX0iKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSBFcnJvciB7REVTSUdOLlJFRH1lbWFpbCIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmV4KCkKCiAgICAgICAgICAgIGFueSgoeCBpbiByZXEudGV4dCBmb3IgeCBpbiAoJ3Bob25lX251bWJlcicsICdlbWFpbCcpKSkgb3IgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IFVua25vd24gVmVyaWZpY2F0aW9uIE1ldGhvZCIpCiAgICAgICAgICAgIHNlbGYuaW5leCgpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgc2VsZi5pbmV4KCkKICAgICAgICBzZWxmLndlYl9zZW5kX2Nob2ljZSgpCiAgICAgICAgc2VsZi53ZWJfc2VuZF9jb2RlKCkKCiAgICBkZWYgd2ViX2xvZ2luKHNlbGYpOgogICAgICAgIHNlbGYud2ViX2hlYWQgPSB7J2FjY2VwdCc6JyovKicsIAogICAgICAgICAnYWNjZXB0LWVuY29kaW5nJzonZ3ppcCwgZGVmbGF0ZSwgYnInLCAKICAgICAgICAgJ2FjY2VwdC1sYW5ndWFnZSc6J2VuLVVTLGVuO3E9MC45JywgCiAgICAgICAgICdjb250ZW50LWxlbmd0aCc6JzI2NycsIAogICAgICAgICAnY29udGVudC10eXBlJzonYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJywgCiAgICAgICAgICdjb29raWUnOidpZ19kaWQ9MDg5NzQ5MUYtQjczNi00RTdFLUE2NTctMzc0MzhEMDk2N0I4OyBjc3JmdG9rZW49eHZBUW9NaXoyZWFVNFJyY21ScDJocWluRFZNZmdrcGU7IHJ1cj1GVFc7IG1pZD1YeFRQZmdBTEFBR0hHUmVFLXhfaTFJU01HNFhyJywgCiAgICAgICAgICdvcmlnaW4nOidodHRwczovL3d3dy5pbnN0YWdyYW0uY29tJywgCiAgICAgICAgICdyZWZlcmVyJzonaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS8nLCAKICAgICAgICAgJ3NlYy1mZXRjaC1kZXN0JzonZW1wdHknLCAKICAgICAgICAgJ3NlYy1mZXRjaC1tb2RlJzonY29ycycsIAogICAgICAgICAnc2VjLWZldGNoLXNpdGUnOidzYW1lLW9yaWdpbicsIAogICAgICAgICAndXNlci1hZ2VudCc6J01vemlsbGEvOTEuODEgKExpbnV4OyBBbmRyb2lkIDYuMzsgTmV4dXMgNSBCdWlsZC9NUkE1OE4pIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS84My4wLjQxMDMuMTE2IE1vYmlsZSBTYWZhcmkvNTM3LjM2JywgCiAgICAgICAgICd4LWNzcmZ0b2tlbic6J3h2QVFvTWl6MmVhVTRScmNtUnAyaHFpbkRWTWZna3BlJywgCiAgICAgICAgICd4LWlnLWFwcC1pZCc6JzEyMTc5ODE2NDQ4Nzk2MjgnLCAKICAgICAgICAgJ3gtaWctd3d3LWNsYWltJzonMCcsIAogICAgICAgICAneC1pbnN0YWdyYW0tYWpheCc6JzE4MGMxNTRkMjE4YScsIAogICAgICAgICAneC1yZXF1ZXN0ZWQtd2l0aCc6J1hNTEh0dHBSZXF1ZXN0J30KICAgICAgICBkYXRhID0geydlbmNfcGFzc3dvcmQnOmYiI1BXRF9JTlNUQUdSQU1fQlJPV1NFUjowOjA6e3NlbGYucGFzc3dvcmR9IiwgCiAgICAgICAgICd1c2VybmFtZSc6c2VsZi51c2VybmFtZSwgCiAgICAgICAgICdvcHRJbnRvT25lVGFwJzonZmFsc2UnfQogICAgICAgIHJlcSA9IHJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vd3d3Lmluc3RhZ3JhbS5jb20vYWNjb3VudHMvbG9naW4vYWpheC8nLCBoZWFkZXJzPShzZWxmLndlYl9oZWFkKSwgZGF0YT1kYXRhKQogICAgICAgIGlmICd1c2VySWQnIGluIHJlcS50ZXh0OgogICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gTG9nZ2VkIEluIHtERVNJR04uQkxVRX0ne3NlbGYudXNlcm5hbWV9JyIpCiAgICAgICAgICAgIHNlbGYuc2Vzc2lvbnMuYXBwZW5kKHJlcS5jb29raWVzLmdldCgnc2Vzc2lvbmlkJykpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgaWYgJ2NoZWNrcG9pbnRfcmVxdWlyZWQnIGluIHJlcS50ZXh0OgogICAgICAgICAgICAgICAgc2VsZi5jb28gPSByZXEuY29va2llcwogICAgICAgICAgICAgICAgc2VsZi51cmwgPSAnaHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbScgKyByZXEuanNvbigpWydjaGVja3BvaW50X3VybCddICsgJz9fX2E9MScKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSBjaGFsbGVuZ2VfcmVxdWlyZWQiKQogICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZW9uZX0gQWNjZXB0IFNlY3VyZSB7REVTSUdOLmJsdWV0d299IENvbnRpbnVlIFRvIFNlY3VyZSBTeXN0ZW06ICIsIGVuZD0nJykKICAgICAgICAgICAgICAgIHNlY21vZGUgPSBpbnB1dCgpCiAgICAgICAgICAgICAgICBpZiBzZWNtb2RlID09ICcxJzoKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5ibHVlcGx1c30gQ2hvb3NlIHtERVNJR04uQkxVRX1UaGlzIHdhcyBtZSIpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZXBsdXN9IEVudGVyIElmIFlvdSBBY2NlcHQ6ICIsIGVuZD0nJykKICAgICAgICAgICAgICAgICAgICBpbnB1dCgpCiAgICAgICAgICAgICAgICAgICAgc2VsZi53ZWJfbG9naW4oKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBpZiBzZWNtb2RlID09ICcyJzoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi53ZWJfY2hhbGxhbmdlKCkKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30gQnJvIGl0J3MganVzdCAxIG9yIDIgV1RGIGlzICd7c2VjbW9kZX0nIikKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmV4KCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7cmVxLnRleHR9LCB7cmVxLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICBzZWxmLmluZXgoKQoKICAgIGRlZiBjaGVja19zZXNzaW9ucyhzZWxmKToKICAgICAgICBmb3Igc2Vzc2lvbmlkIGluIHNlbGYuc2Vzc2lvbnM6CiAgICAgICAgICAgIGhlYWQgPSB7J3VzZXItYWdlbnQnOmYiSW5zdGFncmFtIDE1MC4wLjAuMC4wMDAgQW5kcm9pZCAoMjkvMTA7IDMwMGRwaTsgNzIweDE0NDA7IHsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX0veycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgZW5fR0I7KSIsIAogICAgICAgICAgICAgJ2Nvb2tpZSc6ZiJzZXNzaW9uaWQ9e3Nlc3Npb25pZH0ifQogICAgICAgICAgICByZXEgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vaS5pbnN0YWdyYW0uY29tL2FwaS92MS9hY2NvdW50cy9jdXJyZW50X3VzZXIvP2VkaXQ9dHJ1ZScsIGhlYWRlcnM9aGVhZCkKICAgICAgICAgICAgaWYgJ3BrJyBpbiByZXEudGV4dCBhbmQgJyJzdGF0dXMiOiJvayInIGluIHJlcS50ZXh0OgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSByZXEuanNvbigpWyd1c2VyJ11bJ3VzZXJuYW1lJ10KICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLmJsdWVwbHVzfSB7c2Vzc2lvbmlkfSB7REVTSUdOLkJMVUV9QHt1c2VybmFtZX0iKQogICAgICAgICAgICAgICAgc2VsZi51c2Vycy5hcHBlbmQodXNlcm5hbWUpCiAgICAgICAgICAgIGVsaWYgcmVxLnN0YXR1c19jb2RlID09IDQwMzoKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7cmVxLnRleHR9LCB7cmVxLnN0YXR1c19jb2RlfSIpCiAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30gQmFkIFNlc3Npb25pZCB7REVTSUdOLlJFRH17c2Vzc2lvbmlkfSIpCiAgICAgICAgICAgICAgICBzZWxmLmluZXgoKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgICAgIHNlbGYuaW5leCgpCgogICAgICAgIGlmIHNlbGYudXNlcnNbMF0gIT0gc2VsZi51c2Vyc1sxXToKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IFlvdSBOZWVkIFR3byB7REVTSUdOLlJFRH1EaWZmZXJlbnQgQXBpIFNlc3Npb25zIHtERVNJR04uV0hJVEV9Rm9yIFRoZSB7REVTSUdOLlJFRH1TYW1lIEFjY291bnQiKQogICAgICAgICAgICBzZWxmLmluZXgoKQoKICAgIGRlZiBjdXJyZW50X3VzZXIoc2VsZik6CiAgICAgICAgaGVhZCA9IHsndXNlci1hZ2VudCc6ZiJJbnN0YWdyYW0gMTUwLjAuMC4wLjAwMCBBbmRyb2lkICgyOS8xMDsgMzAwZHBpOyA3MjB4MTQ0MDsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfS97Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyB7Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5kaWdpdHMpLCBrPTE2KSl9OyBlbl9HQjspIiwgICdjb29raWUnOmYic2Vzc2lvbmlkPXtzZWxmLnNlc3Npb25zWzBdfSJ9CiAgICAgICAgcmVxID0gcmVxdWVzdHMuZ2V0KCdodHRwczovL2kuaW5zdGFncmFtLmNvbS9hcGkvdjEvYWNjb3VudHMvY3VycmVudF91c2VyLz9lZGl0PXRydWUnLCBoZWFkZXJzPWhlYWQpCiAgICAgICAgaWYgJ3BrJyBpbiByZXEudGV4dCBhbmQgJyJzdGF0dXMiOiJvayInIGluIHJlcS50ZXh0OgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLnVzZXJuYW1lID0gcmVxLmpzb24oKVsndXNlciddWyd1c2VybmFtZSddCiAgICAgICAgICAgICAgICBzZWxmLmZ1bGxfbmFtZSA9IHJlcS5qc29uKClbJ3VzZXInXVsnZnVsbF9uYW1lJ10KICAgICAgICAgICAgICAgIHNlbGYuYmlvZ3JhcGh5ID0gcmVxLmpzb24oKVsndXNlciddWydiaW9ncmFwaHknXQogICAgICAgICAgICAgICAgc2VsZi5leHRlcm5hbF91cmwgPSByZXEuanNvbigpWyd1c2VyJ11bJ2V4dGVybmFsX3VybCddCiAgICAgICAgICAgICAgICBzZWxmLmVtYWlsID0gcmVxLmpzb24oKVsndXNlciddWydlbWFpbCddCiAgICAgICAgICAgICAgICBzZWxmLnBob25lX251bWJlciA9IHJlcS5qc29uKClbJ3VzZXInXVsncGhvbmVfbnVtYmVyJ10KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlcnI6CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtlcnJ9IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30ge3JlcS50ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5pbmV4KCkKICAgICAgICAgICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgICAgICAgICAgZXJyID0gTm9uZQogICAgICAgICAgICAgICAgICAgIGRlbCBlcnIKCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04ucmVkbWludXN9IHtyZXEudGV4dH0sIHtyZXEuc3RhdHVzX2NvZGV9IikKICAgICAgICAgICAgc2VsZi5pbmV4KCkKCiAgICBkZWYgY2hlY2soc2VsZik6CiAgICAgICAgaGVhZCA9IHsndXNlci1hZ2VudCc6IGYiSW5zdGFncmFtIDEwMC4wLjAuMC4wMDAgQW5kcm9pZCAoMjkvMTA7IDMwMGRwaTsgNzIweDE0NDA7IHsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX0veycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgZW5fR0I7KSJ9CiAgICAgICAgZGF0YSA9IHsnZGV2aWNlX2lkJzp1dWlkLnV1aWQ0KCksIAogICAgICAgICAndXVpZCc6dXVpZC51dWlkNCgpLCAKICAgICAgICAgJ2VtYWlsJzpmInsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTUpKX1AZ21haWwuY29tIiwgCiAgICAgICAgICdwYXNzd29yZCc6Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSArIHN0cmluZy5hc2NpaV91cHBlcmNhc2UpLCBrPTEwKSksIAogICAgICAgICAnX2NzcmZ0b2tlbic6J21pc3NpbmcnLCAKICAgICAgICAgJ2ZpcnRfbmFtZSc6Jycuam9pbihyYW5kb20uY2hvaWNlcygoc3RyaW5nLmFzY2lpX2xvd2VyY2FzZSksIGs9NikpLCAKICAgICAgICAgJ3VzZXJuYW1lJzpzZWxmLnVzZXJuYW1lfQogICAgICAgIHJlcSA9IHJlcXVlc3RzLnBvc3QoJ2h0dHBzOi8vaS5pbnN0YWdyYW0uY29tL2FwaS92MS9hY2NvdW50cy9jcmVhdGVfdmFsaWRhdGVkLycsIGhlYWRlcnM9aGVhZCwgZGF0YT1kYXRhKQogICAgICAgIGlmICdQbGVhc2UgdHJ5IGFub3RoZXInIGluIHJlcS50ZXh0OgogICAgICAgICAgICBzZWxmLmJ5cGFzcyA9IFRydWUKICAgICAgICBlbHNlOgogICAgICAgICAgICBpZiAidXNlcm5hbWUgaXNuJ3QgYXZhaWxhYmxlIiBpbiByZXEudGV4dDoKICAgICAgICAgICAgICAgIHNlbGYuYnlwYXNzID0gRmFsc2UKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7cmVxLnRleHR9IikKICAgICAgICAgICAgICAgIHNlbGYuYnlwYXNzID0gVHJ1ZQoKICAgIGRlZiBlZGl0X3Byb2ZpbGUoc2VsZiwgdXNlcm5hbWUpOgogICAgICAgIHNlc3Npb25pZCA9IHNlbGYuc2Vzc2lvbnNbMV0KICAgICAgICBzZWxmLnNlc3Npb25zLnJlbW92ZShzZXNzaW9uaWQpCiAgICAgICAgaGVhZCA9IHsndXNlci1hZ2VudCc6ZiJJbnN0YWdyYW0gMTg1LjAuMC4wMC4wMDAgQW5kcm9pZCAoMjkvMTA7IDMyMGRwaTsgNzIweDE0OTE7IHsnJy5qb2luKHJhbmRvbS5jaG9pY2VzKChzdHJpbmcuYXNjaWlfbG93ZXJjYXNlICsgc3RyaW5nLmRpZ2l0cyksIGs9MTYpKX0veycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgeycnLmpvaW4ocmFuZG9tLmNob2ljZXMoKHN0cmluZy5hc2NpaV9sb3dlcmNhc2UgKyBzdHJpbmcuZGlnaXRzKSwgaz0xNikpfTsgZW5fR0I7KSIsIAogICAgICAgICAnY29va2llJzpmInNlc3Npb25pZD17c2Vzc2lvbmlkfSJ9CiAgICAgICAgZGF0YSA9IHsnZXh0ZXJuYWxfdXJsJzpzZWxmLmV4dGVybmFsX3VybCwgCiAgICAgICAgICdwaG9uZV9udW1iZXInOnNlbGYucGhvbmVfbnVtYmVyLCAKICAgICAgICAgJ3VzZXJuYW1lJzp1c2VybmFtZSwgCiAgICAgICAgICdmaXJzdF9uYW1lJzpzZWxmLmZ1bGxfbmFtZSwgCiAgICAgICAgICdfdWlkJzonMTM1MTAyNzcyNicsIAogICAgICAgICAnZGV2aWNlX2lkJzp1dWlkLnV1aWQ0KCksIAogICAgICAgICAnYmlvZ3JhcGh5JzpzZWxmLmJpb2dyYXBoeSwgCiAgICAgICAgICdfdXVpZCc6dXVpZC51dWlkNCgpLCAKICAgICAgICAgJ2VtYWlsJzpzZWxmLmVtYWlsfQogICAgICAgIHRyeToKICAgICAgICAgICAgcmVxID0gcmVxdWVzdHMucG9zdCgnaHR0cHM6Ly9pLmluc3RhZ3JhbS5jb20vYXBpL3YxL2FjY291bnRzL2VkaXRfcHJvZmlsZS8nLCBoZWFkZXJzPWhlYWQsIGRhdGE9ZGF0YSkKICAgICAgICAgICAgaWYgJyJzdGF0dXMiOiJvayInIGluIHJlcS50ZXh0IGFuZCByZXEuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgcHJpbnQoZiJcbntERVNJR04uYmx1ZXBsdXN9IFVzZXJuYW1lIENoYW5nZWQge0RFU0lHTi5CTFVFfUB7dXNlcm5hbWV9IikKICAgICAgICAgICAgICAgIHNlbGYudXNlcm5hbWVfY2hhbmdlZCA9IFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlmIGFueSgoeCBpbiByZXEudGV4dCBmb3IgeCBpbiAoJ1RyeSBBZ2FpbiBMYXRlcicsICcibWVzc2FnZSI6IiInKSkpIGFuZCByZXEuc3RhdHVzX2NvZGUgPT0gNDAwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiXG57REVTSUdOLnJlZG1pbnVzfSB7cmVxLnRleHR9LCB7cmVxLnN0YXR1c19jb2RlfSB7bGVuKHNlbGYuc2Vzc2lvbnMpfSIpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZXNzaW9ucy5hcHBlbmQoc2Vzc2lvbmlkKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChmIlxue0RFU0lHTi5yZWRtaW51c30ge3JlcS50ZXh0fSwge3JlcS5zdGF0dXNfY29kZX0iKQogICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgc2VsZi5zZXNzaW9ucy5hcHBlbmQoc2Vzc2lvbmlkKQoKICAgIGRlZiByYW5kb21fcHJveHkoc2VsZik6CiAgICAgICAgcHJveCA9IHJhbmRvbS5jaG9pY2UocHJveGllcykKICAgICAgICBwcm94eSA9IHsnaHR0cCc6ZiJzb2NrczQ6Ly97cHJveH0iLCAgJ2h0dHBzJzpmInNvY2tzNDovL3twcm94fSJ9CiAgICAgICAgcmV0dXJuIHByb3h5CiAgICAKICAgIGRlZiBjb3VudGVyKHNlbGYpOgogICAgICAgIG9zLnN5c3RlbShmInRpdGxlIERvbmUgOiB7c2VsZi5kb25lfSAvIEVycm9yIDoge3NlbGYuZXJyb3J9IikKICAgICAgICAKICAgIGRlZiBtYWluKHNlbGYpOgogICAgICAgIHdoaWxlIHNlbGYucnVuOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBzZWxmLnNldF91c2VybmFtZShzZWxmLnJhbmRvbV9wcm94eSgpKQogICAgICAgICAgICAgICAgaWYgc2VsZi5kb25lID49IDE1OgogICAgICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxmLnVzZXJuYW1lX2NoYW5nZWQ6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuZWRpdF9wcm9maWxlKHNlbGYubmV3X3VzZXJuYW1lKQogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLnNldF91c2VybmFtZSgnJykKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnNldCA
